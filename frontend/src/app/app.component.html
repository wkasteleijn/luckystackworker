@if (isPsfPanelVisible) {
<app-synthetic-psf-panel
  [imageData]="psfImage"
  [nightMode]="nightMode"
  [spinnerShown]="shouldShowSpinner()"
  [psf]="profile.psf"
  [profileName]="profile.name"
  (close)="hidePSF()"
  (slidersChanged)="psfSlidersChanged($event)"
  (loadCustomPSF)="loadCustomPSFClicked()"
></app-synthetic-psf-panel>
} @if (isRotationPanelVisible) {
<app-rotation-panel
  [angle]="rotationAngle"
  [nightMode]="nightMode"
  [spinnerShown]="shouldShowSpinner()"
  (close)="hideRotationPanel()"
  (angleChanged)="rotationAngleChanged($event)"
></app-rotation-panel>
} @if (isProgressPanelVisible) {
<app-progress-panel
  [workerProgress]="workerProgress"
  [workerStatus]="workerStatus"
  [nightMode]="nightMode"
  [spinnerShown]="shouldShowSpinner()"
  (stop)="stopWorker()"
></app-progress-panel>
} @if (isDerotationPanelVisible) {
<app-derotation-panel
  [deRotation]="deRotation"
  [nightMode]="nightMode"
  [spinnerShown]="shouldShowSpinner()"
  [images]="deRotation.images"
  (close)="hideDeRotationPanel()"
  (start)="startDeRotation($event)"
></app-derotation-panel>
} @if (isNotificationVisible) {
<app-notification
  [notificationText]="notificationText"
  [nightMode]="nightMode"
  [spinnerShown]="shouldShowSpinner()"
  (close)="hideNotification()"
></app-notification>
} @if ( isPsfPanelVisible || isRotationPanelVisible || isProgressPanelVisible ||
isDerotationPanelVisible || isNotificationVisible ) {
<div class="backdrop"></div>
} @if (showNewVersionPopup) {
<app-newversion
  [version]="versionInfo?.latestVersion"
  (close)="hideNewVersionPopup()"
  (getItNow)="hideNewVersionPopup(); openDownloadPage()"
  [releaseNotes]="versionInfo?.releaseNotes"
></app-newversion>
} @if (shouldShowSpinner()) {
<div>
  <mat-progress-spinner
    class="spinner"
    mode="indeterminate"
    diameter="120"
    [color]="colorTheme()"
  >
  </mat-progress-spinner>
</div>
}
<div
  class="{{
    nightModeEnabled()
      ? 'container containerColorNight'
      : 'container containerColor'
  }}"
>
  <div class="button_container topButtonContainer">
    @if (openRefImageEnabled()) {
    <button
      type="button"
      mat-button
      (click)="openReferenceImage()"
      class="{{
        nightModeEnabled() ? 'activeColorNight button' : 'activeColor button'
      }}"
      matTooltip="Open"
    >
      <img src="assets/images/open.png" class="openButton zoomIcon" />
    </button>
    } @if (!openRefImageEnabled()) {
    <button type="button" mat-button disabled class="button_disabled">
      <img src="assets/images/open.png" class="openButton zoomIcon" />
    </button>
    }

    <mat-form-field appearance="fill">
      <select
        matNativeControl
        [disabled]="shouldShowSpinner()"
        [(ngModel)]="openImageMode"
        name="openAs"
        (change)="openImageModeChanged()"
        matTooltip="Select channel for opening"
        class="{{
          !refImageSelected || !openRefImageEnabled()
            ? 'channelDropdown dropdownMargin dropdown_disabled'
            : nightModeEnabled()
            ? 'channelDropdown dropdownMargin dropdown activeColorNight'
            : 'channelDropdown dropdownMargin dropdown activeColor'
        }}"
      >
        @for (mode of openImageModes; track mode) {
        <option [value]="mode.value">
          {{ mode.viewValue }}
        </option>
        }
      </select>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <select
        matNativeControl
        [disabled]="shouldShowSpinner()"
        [(ngModel)]="scale"
        (change)="scaleChanged()"
        matTooltip="Select scale used for opening"
        class="{{
          'dropdownMargin ' +
            (isRunningOnWindows() ? 'winScaleSelector ' : 'macScaleSelector ') +
            (!refImageSelected || !openRefImageEnabled()
              ? 'dropdown_disabled'
              : nightModeEnabled()
              ? 'dropdown activeColorNight'
              : 'dropdown activeColor')
        }}"
      >
        <option [value]="1">1x</option>
        <option [value]="1.5">1.5x</option>
        <option [value]="2">2x</option>
        <option [value]="3">3x</option>
      </select>
    </mat-form-field>

    @if (openRefImageEnabled() && refImageSelected) {
    <button
      type="button"
      mat-button
      (click)="openRotationPanel()"
      class="{{
        'buttonZoom buttonMargin ' +
          (nightModeEnabled() ? 'activeColorNight' : 'activeColor') +
          (rotationAngle !== 0 ? 'Pressed' : '')
      }}"
      matTooltip="Rotate"
    >
      <img src="assets/images/rotate.png" class="rotate" />
    </button>
    } @if (!openRefImageEnabled() || !refImageSelected) {
    <button
      type="button"
      mat-button
      disabled
      class="button_disabled buttonMargin"
      matTooltip="Rotate"
    >
      <img src="assets/images/rotate.png" class="rotate" />
    </button>
    }

    <mat-form-field appearance="fill">
      <select
        matNativeControl
        [disabled]="!refImageSelected || !openRefImageEnabled()"
        [(ngModel)]="selectedProfile"
        name="profile"
        (change)="profileSelectionChanged()"
        class="{{
          'dropdownMargin profileSelector ' +
            (!refImageSelected || !openRefImageEnabled()
              ? ' dropdown_disabled'
              : nightModeEnabled()
              ? ' dropdown activeColorNight'
              : ' dropdown activeColor')
        }}"
        matTooltip="Select  profile"
      >
        @for (profile of profiles; track profile) {
        <option [value]="profile.value">
          {{ profile.viewValue }}
        </option>
        }
      </select>
    </mat-form-field>

    @if (openRefImageEnabled() && refImageSelected) {
    <button
      type="button"
      mat-button
      class="button buttonMargin {{
        nightModeEnabled() ? 'activeColorNight' : 'activeColor'
      }}"
      (click)="loadProfile()"
      matTooltip="Load profile"
    >
      <img src="assets/images/loadprofile.png" class="genericButton" />
    </button>
    } @if (!openRefImageEnabled() || !refImageSelected) {
    <button
      type="button"
      mat-button
      disabled
      class="button_disabled buttonMargin"
      matTooltip="Load profile"
    >
      <img src="assets/images/loadprofile.png" class="genericButton" />
    </button>
    } @if (openRefImageEnabled() && refImageSelected) {
    <button
      type="button"
      mat-button
      (click)="roiSelectionChanged()"
      class="{{
        'roiMargin buttonZoom ' +
          (nightModeEnabled() ? 'activeColorNight' : 'activeColor') +
          (roiEnabled() ? 'Pressed' : '')
      }}"
      matTooltip="Select ROI"
    >
      <img src="assets/images/roi.png" class="genericButton" />
    </button>
    } @if (!openRefImageEnabled() || !refImageSelected) {
    <button
      type="button"
      mat-button
      disabled
      class="roiMargin button_disabled"
      matTooltip="Select ROI"
    >
      <img src="assets/images/roi.png" class="genericButton" />
    </button>
    } @if (openRefImageEnabled() && refImageSelected) {
    <button
      type="button"
      mat-button
      (click)="maximize()"
      class="{{
        (nightModeEnabled()
          ? 'buttonZoom relatedButtonsSpace activeColorNight'
          : 'buttonZoom relatedButtonsSpace activeColor') +
          (isMaximized ? 'Pressed' : '')
      }}"
      matTooltip="Show at 100% scale"
    >
      <img src="assets/images/maximize.png" class="genericButton" />
    </button>
    } @if (!openRefImageEnabled() || !refImageSelected) {
    <button
      type="button"
      mat-button
      disabled
      class="buttonDisabledZoom relatedButtonsSpace"
    >
      <img src="assets/images/maximize.png" class="genericButton" />
    </button>
    }
  </div>

  <!-- Floating buttons -->
  <div class="verticalSeparator"></div>
  @if (openRefImageEnabled() && refImageSelected) {
  <button
    type="button"
    mat-button
    (click)="channelChanged()"
    class="{{
      'buttonChannelSwitcher buttonMargin ' +
        (nightModeEnabled() ? 'activeColorNight' : 'activeColor')
    }}"
    matTooltip="Switch visible channel"
  >
    @if (visibleChannel === 'RGB') {
    <img src="assets/images/rgb.png" class="channelSwitcher" />
    } @if (visibleChannel === 'R') {
    <img src="assets/images/red.png" class="channelSwitcher" />
    } @if (visibleChannel === 'G') {
    <img src="assets/images/green.png" class="channelSwitcher" />
    } @if (visibleChannel === 'B') {
    <img src="assets/images/blue.png" class="channelSwitcher" />
    }
  </button>
  } @if (!openRefImageEnabled() || !refImageSelected) {
  <button
    type="button"
    mat-button
    disabled
    class="buttonChannelSwitcherDisabled buttonMargin"
    matTooltip="Switch channel"
  >
    @if (visibleChannel === 'RGB') {
    <img src="assets/images/rgb.png" class="channelSwitcher" />
    } @if (visibleChannel === 'R') {
    <img src="assets/images/red.png" class="channelSwitcher" />
    } @if (visibleChannel === 'G') {
    <img src="assets/images/green.png" class="channelSwitcher" />
    } @if (visibleChannel === 'B') {
    <img src="assets/images/blue.png" class="channelSwitcher" />
    }
  </button>
  } @if (openRefImageEnabled() && refImageSelected) {
  <button
    type="button"
    mat-button
    (click)="zoomIn()"
    class="{{
      (nightModeEnabled()
        ? 'plusZoom buttonZoom activeColorNight'
        : 'plusZoom buttonZoom activeColor') + (isZoomedIn() ? 'Pressed' : '')
    }}"
    matTooltip="Zoom in"
  >
    <img src="assets/images/zoomin.png" class="genericButton" />
  </button>
  } @if (!openRefImageEnabled() || !refImageSelected) {
  <button type="button" mat-button disabled class="plusZoom buttonDisabledZoom">
    <img src="assets/images/zoomin.png" class="genericButton" />
  </button>
  } @if (openRefImageEnabled() && refImageSelected) {
  <button
    type="button"
    mat-button
    (click)="zoomOut()"
    class="{{
      (nightModeEnabled()
        ? 'minZoom buttonZoom relatedButtonsSpace activeColorNight'
        : 'minZoom buttonZoom relatedButtonsSpace activeColor') +
        (isZoomedOut() ? 'Pressed' : '')
    }}"
    matTooltip="Zoom out"
  >
    <img src="assets/images/zoomout.png" class="minZoomButton" />
  </button>
  } @if (!openRefImageEnabled() || !refImageSelected) {
  <button
    type="button"
    mat-button
    disabled
    class="minZoom buttonDisabledZoom relatedButtonsSpace"
  >
    <img src="assets/images/zoomout.png" class="minZoomButton" />
  </button>
  }

  <!-- End floating buttons -->

  <div class="button_container_top button_container">
    @if (openRefImageEnabled() && refImageSelected) {
    <button
      type="button"
      mat-button
      (click)="openConfirmation(resetToRawText)"
      class="{{
        'buttonRevert ' +
          (nightModeEnabled() ? 'activeColorNight' : 'activeColor')
      }}"
      matTooltip="Revert changes"
    >
      <img src="assets/images/reset.png" class="revertImg" />
    </button>
    } @if (!refImageSelected || !openRefImageEnabled()) {
    <button type="button" mat-button disabled class="buttonRevertDisabled">
      <img src="assets/images/reset.png" class="revertImg" />
    </button>
    }

    <mat-form-field appearance="fill">
      <input
        matInput
        type="text"
        [disabled]="!refImageSelected || !openRefImageEnabled()"
        [(ngModel)]="rootFolder"
        (click)="selectRootFolder()"
        class="{{
          !refImageSelected || !openRefImageEnabled()
            ? 'dropdown_disabled rootFolder'
            : nightModeEnabled()
            ? ' activeColorNight dropdown rootFolder'
            : 'activeColor dropdown rootFolder'
        }}"
        matTooltip="Select root folder"
      />
    </mat-form-field>
  </div>

  <div class="button_container_top button_container">
    <!-- Batch functions panel -->
    <mat-card class="card cardColor">
      <mat-card-content class="batchBar">
        <div class="sliderRow">
          <span
            class="workerLabel {{
              nightModeEnabled()
                ? 'sliderRowCategoryTitleColorNight'
                : 'sliderRowCategoryTitleColor'
            }}"
            >Batch</span
          >
          @if (openRefImageEnabled() && refImageSelected) {
          <button
            type="button"
            mat-button
            (click)="applyProfileBatch()"
            class="button {{
              nightModeEnabled() ? 'activeColorNight' : 'activeColor'
            }}"
            matTooltip="Process {{ selectedProfile }} stacks in root folder"
          >
            <img src="assets/images/startbatch.png" class="startBatchButton" />
          </button>
          } @if (!openRefImageEnabled() || !refImageSelected) {
          <button type="button" mat-button disabled class="button_disabled">
            <img src="assets/images/startbatch.png" class="startBatchButton" />
          </button>
          } @if (openRefImageEnabled() && refImageSelected) {
          <button
            type="button"
            mat-button
            (click)="realtimeEnabledChanged()"
            class="{{
              'relatedButtonsSpace buttonZoom connectButton ' +
                (nightModeEnabled() ? 'activeColorNight' : 'activeColor') +
                (realtimeEnabled ? 'Pressed' : '')
            }}"
            matTooltip="Connect to stacking software"
          >
            <img src="assets/images/connect.png" class="genericButton" />
          </button>
          } @if (!openRefImageEnabled() || !refImageSelected) {
          <button
            type="button"
            mat-button
            disabled
            class="relatedButtonsSpace buttonDisabledZoom connectButton"
            matTooltip="Connect to stacking software"
          >
            <img src="assets/images/connect.png" class="genericButton" />
          </button>
          } @if (openRefImageEnabled() && refImageSelected) {
          <button
            type="button"
            mat-button
            (click)="loadFilesForDerotation()"
            class="relatedButtonsSpace button {{
              nightModeEnabled() ? 'activeColorNight' : 'activeColor'
            }}"
            matTooltip="Derotate images"
          >
            <img src="assets/images/derotate.png" class="stopBatchButton" />
          </button>
          } @if (!openRefImageEnabled() || !refImageSelected) {
          <button
            type="button"
            mat-button
            disabled
            class="relatedButtonsSpace button_disabled"
          >
            <img src="assets/images/derotate.png" class="stopBatchButton" />
          </button>
          } @if (openRefImageEnabled() && refImageSelected) {
          <button
            type="button"
            mat-button
            (click)="stackImages()"
            class="relatedButtonsSpace button {{
              nightModeEnabled() ? 'activeColorNight' : 'activeColor'
            }}"
            matTooltip="Stack images"
          >
            <img src="assets/images/stack.png" class="stopBatchButton" />
          </button>
          } @if (!openRefImageEnabled() || !refImageSelected) {
          <button
            type="button"
            mat-button
            disabled
            class="relatedButtonsSpace button_disabled"
          >
            <img src="assets/images/stack.png" class="stopBatchButton" />
          </button>
          }
        </div>
      </mat-card-content>
    </mat-card>

    @if (openRefImageEnabled() && refImageSelected) {
    <button
      type="button"
      mat-button
      (click)="nightModeChanged()"
      class="{{
        'button3thRow buttonMargin ' +
          (nightModeEnabled() ? 'activeColorNight' : 'activeColor') +
          (nightModeEnabled() ? 'Pressed' : '')
      }}"
      matTooltip="Night mode"
    >
      <img src="assets/images/nightmode.png" class="genericButton" />
    </button>
    } @if (!refImageSelected || !openRefImageEnabled()) {
    <button
      type="button"
      mat-button
      disabled
      class="button3thRowDisabled buttonMargin"
    >
      <img src="assets/images/nightmode.png" class="genericButton" />
    </button>
    } @if (openRefImageEnabled() && showVersionButton()) {
    <button
      type="button"
      mat-button
      class="button3thRow infoButtonMargin {{
        nightModeEnabled() ? 'activeColorNight' : 'activeColor'
      }}"
      (click)="showVersionButton() ? openDownloadPage() : openAbout()"
      matTooltip="You are currently using an older version {{
        versionInfo.localVersion
      }}. Don't miss out on the latest new features & improvement by downloading the latest version {{
        versionInfo.latestVersion
      }}."
    >
      <img
        src="assets/images/info.png"
        class="infoButton zoomIcon buttonBottom"
      />
    </button>
    } @if (!openRefImageEnabled() && showVersionButton()) {
    <button
      type="button"
      mat-button
      disabled
      class="button3thRowDisabled infoButtonMargin {{
        nightModeEnabled() ? 'activeColorNight' : 'activeColor'
      }}"
      matTooltip="You are currently using an older version {{
        getCurrentVersion()
      }}. Don't miss out on the latest new features & improvement by downloading the latest version {{
        getLatestKnownVersion()
      }}."
    >
      <img
        src="assets/images/info.png"
        class="infoButton zoomIcon buttonBottom"
      />
    </button>
    } @if (openRefImageEnabled() && !showVersionButton()) {
    <button
      type="button"
      mat-button
      class="button3thRow infoButtonMargin {{
        nightModeEnabled() ? 'activeColorNight' : 'activeColor'
      }}"
      (click)="openAbout()"
      matTooltip="About"
    >
      <img
        src="assets/images/info.png"
        class="infoButton zoomIcon buttonBottom"
      />
    </button>
    } @if (!openRefImageEnabled() && !showVersionButton()) {
    <button
      type="button"
      mat-button
      disabled
      class="button3thRowDisabled infoButtonMargin"
      matTooltip="About"
    >
      <img
        src="assets/images/info.png"
        class="infoButton zoomIcon buttonBottom"
      />
    </button>
    } @if (openRefImageEnabled() && refImageSelected) {
    <button
      type="button"
      mat-button
      (click)="saveReferenceImage()"
      class="button3thRow infoButtonMargin {{
        nightModeEnabled() ? 'activeColorNight' : 'activeColor'
      }}"
      matTooltip="Save"
    >
      <img src="assets/images/save.png" class="saveButton zoomIcon" />
    </button>
    } @if (!refImageSelected || !openRefImageEnabled()) {
    <button
      type="button"
      mat-button
      disabled
      class="button3thRowDisabled infoButtonMargin"
    >
      <img src="assets/images/save.png" class="saveButton zoomIcon" />
    </button>
    } @if (openRefImageEnabled() && refImageSelected) {
    <button
      type="button"
      mat-button
      (click)="blinkClippedAreasChanged()"
      class="{{
        'button3thRow buttonMarginHighlight ' +
          (nightModeEnabled() ? 'activeColorNight' : 'activeColor') +
          (blinkClippedAreas ? 'Pressed' : '')
      }}"
      matTooltip="Highlight clipped areas"
    >
      <img src="assets/images/highlight-clipped.png" class="genericButton" />
    </button>
    } @if (!refImageSelected || !openRefImageEnabled()) {
    <button
      type="button"
      mat-button
      disabled
      class="button3thRowDisabled buttonMarginHighlight"
    >
      <img src="assets/images/highlight-clipped.png" class="genericButton" />
    </button>
    }
  </div>

  <!-- Filter slider tabs -->
  <mat-tab-group class="sliderTabs" selectedIndex="0">
    <mat-tab label="Deconv. & Sharpen">
      <!-- Sharpen panel -->
      <div class="sliderRow">
        <div
          class="sliderRowCategoryTitle {{
            nightModeEnabled()
              ? 'sliderRowCategoryTitleColorNight'
              : 'sliderRowCategoryTitleColor'
          }}"
        >
          Sharpen
        </div>
        <div class="lswRadio">
          <mat-radio-group
            [color]="colorTheme()"
            [disabled]="shouldShowSpinner() || !refImageSelected"
            [(ngModel)]="sharpenMode"
            (change)="sharpenModeChanged($event, true)"
            class="sharpenMode"
          >
            <mat-radio-button value="RGB" class="radioSizeButtonSharpen"
              >RGB</mat-radio-button
            >
            <mat-radio-button
              value="LUMINANCE"
              class="radioSizeButton sharpenModeRGB"
              >Luminance
            </mat-radio-button>
          </mat-radio-group>
        </div>
        @if (sharpenMode === 'LUMINANCE') {
        <div>
          <mat-checkbox
            [(ngModel)]="luminanceIncludeRed"
            (change)="sharpenModeChanged(undefined, true)"
            [color]="colorTheme()"
            [disabled]="shouldShowSpinner() || !refImageSelected"
            >Red</mat-checkbox
          >
          <mat-checkbox
            [(ngModel)]="luminanceIncludeGreen"
            (change)="sharpenModeChanged(undefined, true)"
            [color]="colorTheme()"
            [disabled]="shouldShowSpinner() || !refImageSelected"
            class="luminanceIncludeBox"
            >Green</mat-checkbox
          >
          <mat-checkbox
            [(ngModel)]="luminanceIncludeBlue"
            (change)="sharpenModeChanged(undefined, true)"
            [color]="colorTheme()"
            class="luminanceIncludeBox"
            [disabled]="shouldShowSpinner() || !refImageSelected"
            >Blue</mat-checkbox
          >
          <mat-checkbox
            [(ngModel)]="luminanceIncludeColor"
            (change)="sharpenModeChanged(undefined, true)"
            [color]="colorTheme()"
            class="luminanceIncludeBox"
            [disabled]="shouldShowSpinner() || !refImageSelected"
            >Color</mat-checkbox
          >
        </div>
        } @if (sharpenMode === 'RGB') {
        <div>
          <mat-radio-group
            [color]="colorTheme()"
            [disabled]="shouldShowSpinner() || !refImageSelected"
            [(ngModel)]="applySharpenToChannel"
            (change)="applySharpenToChannelChanged($event)"
            class="sharpenMode"
          >
            <mat-radio-button value="RGB">All</mat-radio-button>
            <mat-radio-button value="R">Red </mat-radio-button>
            <mat-radio-button value="G">Green</mat-radio-button>
            <mat-radio-button value="B">Blue</mat-radio-button>
          </mat-radio-group>
        </div>
        }
      </div>
      <div class="sharpenTypeMargin sliderRow">
        @if (!applyWienerDeconvolution) {
        <div class="noWiener">&nbsp;</div>
        }
        <div class="methodsLabel">Methods</div>
        <div class="slider">
          @if ( applyWienerDeconvolution && openRefImageEnabled() &&
          refImageSelected ) {
          <button
            type="button"
            mat-button
            (click)="createPSF()"
            class="{{
              'psfButton buttonZoom ' +
                (nightModeEnabled() ? 'activeColorNight' : 'activeColor')
            }}"
            matTooltip="Load PSF"
          >
            <img src="assets/images/synth-psf.png" class="psfButtonImg" />
          </button>
          } @if ( !applyWienerDeconvolution || !openRefImageEnabled() ||
          !refImageSelected ) {
          <button
            type="button"
            mat-button
            disabled
            class="psfButton psfButtonDisabled buttonDisabledZoom"
            matTooltip="Load PSF"
          >
            <img src="assets/images/synth-psf.png" class="psfButtonImg" />
          </button>
          }

          <mat-checkbox
            [(ngModel)]="applyWienerDeconvolution"
            (change)="applyWienerDeconvolutionChanged()"
            [color]="colorTheme()"
            class="luminanceIncludeBox"
            [disabled]="shouldShowSpinner() || !refImageSelected"
            >Deconvolve</mat-checkbox
          >

          <mat-checkbox
            [(ngModel)]="applyUnsharpMask"
            (change)="applyUnsharpMaskChanged()"
            [color]="colorTheme()"
            class="applyUnsharpMaskCheckBox"
            [disabled]="shouldShowSpinner() || !refImageSelected"
            >Sharpen</mat-checkbox
          >

          @if (applyWienerDeconvolution) {
          <mat-checkbox
            [(ngModel)]="wienerDeconvolutionQuadratic"
            (change)="applyWienerDeconvolutionQuadraticChanged()"
            [color]="colorTheme()"
            class="applyUnsharpMaskCheckBox"
            [disabled]="shouldShowSpinner() || !refImageSelected"
            >Quadratic Deconvolution</mat-checkbox
          >
          }
        </div>
      </div>

      <div class="sliderRow">
        <div class="sliderLabel">Suppress clipping</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="1"
            min="0"
            max="100"
            (input)="clippingSuppressionChanged($event, false)"
            (change)="clippingSuppressionChanged($event, true)"
            [value]="clippingSuppression"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="clippingSuppression"
            sliderInputMinValue="0"
            sliderInputMaxValue="100"
            (sliderInputValueChanged)="clippingSuppressionChanged($event, true)"
          />
        </div>
      </div>

      @if (applyWienerDeconvolution) {
      <span>
        <div class="sliderRow">
          <div class="sliderLabel">Deconv. iterations</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              step="1"
              min="1"
              max="40"
              (input)="wienerIterationsChanged($event, false)"
              (change)="wienerIterationsChanged($event, true)"
              [(ngModel)]="wienerIterations"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="wienerIterations"
              sliderInputMinValue="1"
              sliderInputMaxValue="40"
              (sliderInputValueChanged)="wienerIterationsChanged($event, true)"
            />
          </div>
        </div>
      </span>
      } @if (applyUnsharpMask) {
      <span>
        <div class="sliderRow">
          <div class="sliderLabel">Radius</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              step="0.1"
              min="0.5"
              max="4"
              (input)="radiusChanged($event, false)"
              (change)="radiusChanged($event, true)"
              [(ngModel)]="radius"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="radius"
              sliderInputMinValue="0.5"
              sliderInputMaxValue="4"
              (sliderInputValueChanged)="radiusChanged($event, true)"
            />
          </div>
        </div>
        <div class="sliderRow">
          <div class="sliderLabel">Amount</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              step="10"
              min="0"
              max="9999"
              (input)="amountChanged($event, false)"
              (change)="amountChanged($event, true)"
              [(ngModel)]="amount"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="amount"
              sliderInputMinValue="0"
              sliderInputMaxValue="9999"
              (sliderInputValueChanged)="amountChanged($event, true)"
            />
          </div>
        </div>
        <div class="sliderRow">
          <div class="sliderLabel">Sharpen iterations</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              tickInterval="1"
              step="1"
              min="1"
              max="10"
              (input)="iterationsChanged($event, false)"
              (change)="iterationsChanged($event, true)"
              [(ngModel)]="iterations"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="iterations"
              sliderInputMinValue="1"
              sliderInputMaxValue="10"
              (sliderInputValueChanged)="iterationsChanged($event, true)"
            />
          </div>
        </div>
      </span>
      }

      <div class="sliderRow">
        <div class="sliderLabel">Blend raw</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            tickInterval="1"
            step="1"
            min="0"
            max="100"
            (input)="blendRawChanged($event, false)"
            (change)="blendRawChanged($event, true)"
            [(ngModel)]="blendRaw"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="blendRaw"
            sliderInputMinValue="0"
            sliderInputMaxValue="100"
            (sliderInputValueChanged)="blendRawChanged($event, true)"
          />
        </div>
      </div>

      <div class="sliderRow">
        <div
          class="edgeArtifactLabel sliderRowCategoryTitle {{
            nightModeEnabled()
              ? 'sliderRowCategoryTitleColorNight'
              : 'sliderRowCategoryTitleColor'
          }}"
        >
          Edge Artefact Suppression
        </div>
        <div class="slider">
          <mat-radio-group
            [color]="colorTheme()"
            [disabled]="shouldShowSpinner() || !refImageSelected"
            [(ngModel)]="edgeArtefactSupressionMode"
            (change)="edgeArtefactSupressionModeChanged($event, true)"
            class="sharpenMode"
          >
            <mat-radio-button value="OFF" class="denoiseMode"
              >Off</mat-radio-button
            >
            <mat-radio-button value="DERING" class="denoiseMode"
              >Dering
            </mat-radio-button>
            <mat-radio-button value="CLIPPING" class="denoiseMode"
              >Clipping</mat-radio-button
            >
          </mat-radio-group>
        </div>
      </div>

      @if (edgeArtefactSupressionMode === 'CLIPPING') {
      <div>
        <div class="sliderRow">
          <div class="sliderLabel">Suppress Clipping</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              tickInterval="1"
              step="1"
              min="1"
              max="100"
              (input)="clippingStrengthChanged($event, false)"
              (change)="clippingStrengthChanged($event, true)"
              [(ngModel)]="clippingStrength"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="clippingStrength"
              sliderInputMinValue="1"
              sliderInputMaxValue="100"
              (sliderInputValueChanged)="clippingStrengthChanged($event, true)"
            />
          </div>
        </div>
        <div class="sliderRow">
          <div class="sliderLabel">Suppression Range</div>
          <div class="slider">
            <mat-slider
              [disabled]="
                shouldShowSpinner() ||
                !refImageSelected ||
                clippingStrength === 0
              "
              tickInterval="1"
              step="1"
              min="1"
              max="100"
              (input)="clippingRangeChanged($event, false)"
              (change)="clippingRangeChanged($event, true)"
              [(ngModel)]="clippingRange"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="clippingRange"
              sliderInputMinValue="1"
              sliderInputMaxValue="100"
              (sliderInputValueChanged)="clippingRangeChanged($event, true)"
            />
          </div>
        </div>
      </div>
      } @if (edgeArtefactSupressionMode === 'DERING') {
      <div>
        <div class="sliderRow">
          <div class="sliderLabel">Strength</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              tickInterval="1"
              step="1"
              min="1"
              max="100"
              (input)="deringStrengthChanged($event, false)"
              (change)="deringStrengthChanged($event, true)"
              [(ngModel)]="deringStrength"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="deringStrength"
              sliderInputMinValue="1"
              sliderInputMaxValue="100"
              (sliderInputValueChanged)="deringStrengthChanged($event, true)"
            />
          </div>
        </div>
        <div class="sliderRow">
          <div class="sliderLabel">Radius</div>
          <div class="slider">
            <mat-slider
              [disabled]="
                shouldShowSpinner() || !refImageSelected || deringStrength === 0
              "
              tickInterval="1"
              step="1"
              min="1"
              max="100"
              (input)="deringRadiusChanged($event, false)"
              (change)="deringRadiusChanged($event, true)"
              [(ngModel)]="deringRadius"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="deringRadius"
              sliderInputMinValue="1"
              sliderInputMaxValue="100"
              (sliderInputValueChanged)="deringRadiusChanged($event, true)"
            />
          </div>
        </div>
      </div>
      }
    </mat-tab>

    <mat-tab label="Denoise & Smoothing">
      <div class="sliderRow">
        <div
          class="sliderRowCategoryTitle {{
            denoiseAlgorithm1 === 'OFF'
              ? 'denoiseOffLabel'
              : nightModeEnabled()
              ? 'sliderRowCategoryTitleColorNight'
              : 'sliderRowCategoryTitleColor'
          }}"
        >
          Denoise
        </div>
        <mat-radio-group
          [color]="colorTheme()"
          [disabled]="shouldShowSpinner() || !refImageSelected"
          [(ngModel)]="denoiseAlgorithm1"
          (change)="denoiseAlgorithm1Changed($event)"
        >
          <mat-radio-button value="OFF" class="radioSizeButtonDenoise"
            >Off</mat-radio-button
          >
          <mat-radio-button value="BILATERAL" class="denoiseMode"
            >Bilateral</mat-radio-button
          >
          <mat-radio-button value="SIGMA1" class="denoiseMode"
            >Sigma 1</mat-radio-button
          >
        </mat-radio-group>
      </div>

      @if (denoiseAlgorithm1 === 'SIGMA1') {
      <div>
        <div class="sliderRow">
          <div class="sliderLabel">Amount</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              tickInterval="1000"
              step="1"
              min="0"
              max="100"
              (input)="denoise1AmountChanged($event, false)"
              (change)="denoise1AmountChanged($event, true)"
              [(ngModel)]="denoise1Amount"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="denoise1Amount"
              sliderInputMinValue="0"
              sliderInputMaxValue="100"
              (sliderInputValueChanged)="denoise1AmountChanged($event, true)"
            />
          </div>
        </div>
        <div class="sliderRow">
          <div class="sliderLabel">Radius</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              tickInterval="1000"
              step="0.1"
              min="0.5"
              max="4"
              (input)="denoise1RadiusChanged($event, false)"
              (change)="denoise1RadiusChanged($event, true)"
              [(ngModel)]="denoise1Radius"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="denoise1Radius"
              sliderInputMinValue="0.5"
              sliderInputMaxValue="4"
              (sliderInputValueChanged)="denoise1RadiusChanged($event, true)"
            />
          </div>
        </div>
        <div class="sliderRow">
          <div class="sliderLabel">Iterations</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              tickInterval="1"
              step="1"
              min="1"
              max="10"
              (input)="denoise1IterationsChanged($event, false)"
              (change)="denoise1IterationsChanged($event, true)"
              [(ngModel)]="denoise1Iterations"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="denoise1Radius"
              sliderInputMinValue="1"
              sliderInputMaxValue="10"
              (sliderInputValueChanged)="
                denoise1IterationsChanged($event, true)
              "
            />
          </div>
        </div>
      </div>
      } @if (denoiseAlgorithm1 === 'BILATERAL') {
      <div>
        <div class="sliderRow">
          <div class="sliderLabel">Sigma color</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              step="1"
              min="1"
              max="1000"
              (input)="bilateralSigmaColorChanged($event, false)"
              (change)="bilateralSigmaColorChanged($event, true)"
              [(ngModel)]="bilateralSigmaColor"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="bilateralSigmaColor"
              sliderInputMinValue="1"
              sliderInputMaxValue="1000"
              (sliderInputValueChanged)="
                bilateralSigmaColorChanged($event, true)
              "
            />
          </div>
        </div>
        <div class="sliderRow">
          <div class="sliderLabel">Radius</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              step="1"
              min="1"
              max="5"
              (input)="bilateralRadiusChanged($event, false)"
              (change)="bilateralRadiusChanged($event, true)"
              [(ngModel)]="bilateralRadius"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="bilateralRadius"
              sliderInputMinValue="1"
              sliderInputMaxValue="5"
              (sliderInputValueChanged)="bilateralRadiusChanged($event, true)"
            />
          </div>
        </div>
        <div class="sliderRow">
          <div class="sliderLabel">Iterations</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              step="1"
              min="1"
              max="10"
              (input)="bilateralIterationsChanged($event, false)"
              (change)="bilateralIterationsChanged($event, true)"
              [(ngModel)]="bilateralIterations"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="bilateralIterations"
              sliderInputMinValue="1"
              sliderInputMaxValue="10"
              (sliderInputValueChanged)="
                bilateralIterationsChanged($event, true)
              "
            />
          </div>
        </div>
      </div>
      }

      <div class="sliderRow">
        <div
          class="sliderRowCategoryTitle {{
            denoiseAlgorithm2 === 'OFF'
              ? 'denoiseOffLabel'
              : nightModeEnabled()
              ? 'sliderRowCategoryTitleColorNight'
              : 'sliderRowCategoryTitleColor'
          }}"
        >
          Smoothing
        </div>
        <mat-radio-group
          [color]="colorTheme()"
          [disabled]="shouldShowSpinner() || !refImageSelected"
          [(ngModel)]="denoiseAlgorithm2"
          (change)="denoiseAlgorithm2Changed($event)"
        >
          <mat-radio-button value="OFF" class="radioSizeButtonDenoise"
            >Off</mat-radio-button
          >
          <mat-radio-button value="SAVGOLAY" class="denoiseMode"
            >Savitzky-Golay</mat-radio-button
          >
          <mat-radio-button value="SIGMA2" class="denoiseMode"
            >Sigma 2</mat-radio-button
          >
        </mat-radio-group>
      </div>
      @if (denoiseAlgorithm2 === 'SAVGOLAY') {
      <div>
        <div class="sliderRow">
          <div class="sliderLabel">Kernel Size</div>
          <div class="slider">
            <mat-slider
              [disabled]="
                shouldShowSpinner() ||
                !refImageSelected ||
                savitzkyGolaySize === '0'
              "
              tickInterval="1"
              step="1"
              min="2"
              max="6"
              (input)="savitzkyGolaySizeChanged($event, false)"
              (change)="savitzkyGolaySizeChanged($event, true)"
              [(ngModel)]="savitzkyGolaySize"
              [color]="colorTheme()"
            ></mat-slider>
            <span
              class="{{
                savitzkyGolaySize === '0'
                  ? 'sliderLabelDisabled'
                  : 'sliderLabel'
              }}"
              >{{ savitzkyGolaySizeDisplayValue }}</span
            >
          </div>
        </div>
        <div class="savgolayRadio"></div>
        <div class="sliderRow">
          <div
            class="{{
              savitzkyGolaySize === '0' ? 'sliderLabelDisabled' : 'sliderLabel'
            }}"
          >
            Amount
          </div>
          <div class="slider">
            <mat-slider
              [disabled]="
                shouldShowSpinner() ||
                !refImageSelected ||
                savitzkyGolaySize === '0'
              "
              tickInterval="1"
              step="1"
              min="1"
              max="100"
              (input)="savitzkyGolayAmountChanged($event, false)"
              (change)="savitzkyGolayAmountChanged($event, true)"
              [(ngModel)]="savitzkyGolayAmount"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="savitzkyGolayAmount"
              sliderInputMinValue="1"
              sliderInputMaxValue="100"
              (sliderInputValueChanged)="
                savitzkyGolayAmountChanged($event, true)
              "
            />
          </div>
        </div>
        <div class="sliderRow">
          <div
            class="{{
              savitzkyGolaySize === '0' ? 'sliderLabelDisabled' : 'sliderLabel'
            }}"
          >
            Iterations
          </div>
          <div class="slider">
            <mat-slider
              [disabled]="
                shouldShowSpinner() ||
                !refImageSelected ||
                savitzkyGolaySize === '0'
              "
              tickInterval="1"
              step="1"
              min="1"
              max="10"
              (input)="savitzkyGolayIterationsChanged($event, false)"
              (change)="savitzkyGolayIterationsChanged($event, true)"
              [(ngModel)]="savitzkyGolayIterations"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="savitzkyGolayIterations"
              sliderInputMinValue="1"
              sliderInputMaxValue="10"
              (sliderInputValueChanged)="
                savitzkyGolayIterationsChanged($event, true)
              "
            />
          </div>
        </div>
      </div>
      } @if (denoiseAlgorithm2 === 'SIGMA2') {
      <div>
        <div class="sliderRow">
          <div class="sliderLabel">Radius</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              tickInterval="1000"
              step="0.1"
              min="0.5"
              max="4"
              (input)="denoise2RadiusChanged($event, false)"
              (change)="denoise2RadiusChanged($event, true)"
              [(ngModel)]="denoise2Radius"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="denoise2Radius"
              sliderInputMinValue="0.5"
              sliderInputMaxValue="4"
              (sliderInputValueChanged)="denoise2RadiusChanged($event, true)"
            />
          </div>
        </div>
        <div class="sliderRow">
          <div class="sliderLabel">Iterations</div>
          <div class="slider">
            <mat-slider
              [disabled]="shouldShowSpinner() || !refImageSelected"
              tickInterval="1"
              step="1"
              min="1"
              max="10"
              (input)="denoise2IterationsChanged($event, false)"
              (change)="denoise2IterationsChanged($event, true)"
              [(ngModel)]="denoise2Iterations"
              [color]="colorTheme()"
            ></mat-slider>
            <app-sliderinput
              [sliderInputValue]="denoise2Iterations"
              sliderInputMinValue="1"
              sliderInputMaxValue="10"
              (sliderInputValueChanged)="
                denoise2IterationsChanged($event, true)
              "
            />
          </div>
        </div>
      </div>
      } @if (denoiseAlgorithm1 !== 'IAN') {
      <div class="sliderRow">
        <div
          class="sliderRowCategoryTitle {{
            nightModeEnabled()
              ? 'sliderRowCategoryTitleColorNight'
              : 'sliderRowCategoryTitleColor'
          }}"
        >
          Apply to
        </div>
        <mat-radio-group
          [color]="colorTheme()"
          [disabled]="shouldShowSpinner() || !refImageSelected"
          [(ngModel)]="applyDenoiseToChannel"
          (change)="applyDenoiseToChannelChanged($event)"
        >
          <mat-radio-button value="RGB" class="radioSizeButtonDenoise2"
            >All</mat-radio-button
          >
          <mat-radio-button value="R" class="denoiseMode">Red</mat-radio-button>
          <mat-radio-button value="G" class="denoiseMode"
            >Green</mat-radio-button
          >
          <mat-radio-button value="B" class="denoiseMode"
            >Blue</mat-radio-button
          >
        </mat-radio-group>
      </div>
      }
    </mat-tab>

    <!-- Light panel -->
    <mat-tab label="Contrast & Light">
      <div class="sliderRow">
        <div
          class="sliderRowCategoryTitle {{
            nightModeEnabled()
              ? 'sliderRowCategoryTitleColorNight'
              : 'sliderRowCategoryTitleColor'
          }}"
        >
          Local Contrast
        </div>
      </div>
      <div class="sliderRow">
        <div class="sliderLabel">Fine Details</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="1"
            min="0"
            max="99"
            (input)="localContrastFineChanged($event, false)"
            (change)="localContrastFineChanged($event, true)"
            [(ngModel)]="localContrastFine"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="localContrastFine"
            sliderInputMinValue="0"
            sliderInputMaxValue="99"
            (sliderInputValueChanged)="localContrastFineChanged($event, true)"
          />
        </div>
      </div>
      <div class="sliderRow">
        <div class="sliderLabel">Medium Details</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="1"
            min="0"
            max="99"
            (input)="localContrastMediumChanged($event, false)"
            (change)="localContrastMediumChanged($event, true)"
            [(ngModel)]="localContrastMedium"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="localContrastMedium"
            sliderInputMinValue="0"
            sliderInputMaxValue="99"
            (sliderInputValueChanged)="localContrastMediumChanged($event, true)"
          />
        </div>
      </div>
      <div class="sliderRow">
        <div class="sliderLabel">Large Details</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="1"
            min="0"
            max="99"
            (input)="localContrastLargeChanged($event, false)"
            (change)="localContrastLargeChanged($event, true)"
            [(ngModel)]="localContrastLarge"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="localContrastLarge"
            sliderInputMinValue="0"
            sliderInputMaxValue="99"
            (sliderInputValueChanged)="localContrastLargeChanged($event, true)"
          />
        </div>
      </div>
      <div class="sliderRow sliderRowLight">
        <div
          class="sliderRowCategoryTitle {{
            nightModeEnabled()
              ? 'sliderRowCategoryTitleColorNight'
              : 'sliderRowCategoryTitleColor'
          }}"
        >
          Light
        </div>
        <div class="preserveDarkBGCheckBox">
          <mat-checkbox
            [(ngModel)]="preserveDarkBackground"
            (change)="preserveDarkBackgroundChanged()"
            [color]="colorTheme()"
            [disabled]="shouldShowSpinner() || !refImageSelected"
            >Preserve dark background</mat-checkbox
          >
        </div>
      </div>
      <div class="sliderRow">
        <div class="sliderLabel">Gamma</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="0.01"
            min="0.0"
            max="2.0"
            (input)="gammaChanged($event, false)"
            (change)="gammaChanged($event, true)"
            [(ngModel)]="gamma"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="gamma"
            sliderInputMinValue="0.0"
            sliderInputMaxValue="2.0"
            (sliderInputValueChanged)="gammaChanged($event, true)"
          />
        </div>
      </div>

      <div class="sliderRow">
        <div class="sliderLabel">Contrast</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="1"
            min="0"
            max="100"
            (input)="contrastChanged($event, false)"
            (change)="contrastChanged($event, true)"
            [(ngModel)]="contrast"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="contrast"
            sliderInputMinValue="0"
            sliderInputMaxValue="100"
            (sliderInputValueChanged)="contrastChanged($event, true)"
          />
        </div>
      </div>

      <div class="sliderRow">
        <div class="sliderLabel">Brightness</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="1"
            min="-100"
            max="100"
            (input)="brightnessChanged($event, false)"
            (change)="brightnessChanged($event, true)"
            [(ngModel)]="brightness"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="brightness"
            sliderInputMinValue="-100"
            sliderInputMaxValue="100"
            (sliderInputValueChanged)="brightnessChanged($event, true)"
          />
        </div>
      </div>

      <div class="sliderRow">
        <div class="sliderLabel">Lightness</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="1"
            min="-100"
            max="100"
            (input)="lightnessChanged($event, false)"
            (change)="lightnessChanged($event, true)"
            [(ngModel)]="lightness"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="lightness"
            sliderInputMinValue="-100"
            sliderInputMaxValue="100"
            (sliderInputValueChanged)="lightnessChanged($event, true)"
          />
        </div>
      </div>

      <div class="sliderRow">
        <div class="sliderLabel">Darken Background</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="1"
            min="0"
            max="100"
            (input)="backgroundChanged($event, false)"
            (change)="backgroundChanged($event, true)"
            [(ngModel)]="background"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="background"
            sliderInputMinValue="0"
            sliderInputMaxValue="100"
            (sliderInputValueChanged)="backgroundChanged($event, true)"
          />
        </div>
      </div>
    </mat-tab>

    <!-- Color & Dispersion panel -->
    <mat-tab label="Color & Dispersion">
      <div
        class="sliderRowCategoryTitle {{
          nightModeEnabled()
            ? 'sliderRowCategoryTitleColorNight'
            : 'sliderRowCategoryTitleColor'
        }}"
      >
        Enhancements
      </div>
      <div class="sliderRow">
        <div class="sliderLabel">Saturation</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="0.01"
            min="1.00"
            max="5.00"
            (input)="saturationChanged($event, false)"
            (change)="saturationChanged($event, true)"
            [(ngModel)]="saturation"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="saturation"
            sliderInputMinValue="1.00"
            sliderInputMaxValue="5.00"
            (sliderInputValueChanged)="saturationChanged($event, true)"
          />
        </div>
      </div>
      <div class="sliderRow">
        <div class="sliderLabel">Reduce Purple</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="1"
            min="0"
            max="255"
            (input)="purpleChanged($event, false)"
            (change)="purpleChanged($event, true)"
            [(ngModel)]="purple"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="purple"
            sliderInputMinValue="0"
            sliderInputMaxValue="255"
            (sliderInputValueChanged)="purpleChanged($event, true)"
          />
        </div>
      </div>

      <div class="sliderRow">
        <div
          class="sliderRowCategoryTitle {{
            nightModeEnabled()
              ? 'sliderRowCategoryTitleColorNight'
              : 'sliderRowCategoryTitleColor'
          }}"
        >
          Balance
        </div>

        <div class="balanceButton">
          @if (openRefImageEnabled() && refImageSelected) {
          <button
            type="button"
            mat-button
            (click)="resetBalanceClicked()"
            class="{{
              'buttonColorBalance buttonZoom ' +
                (nightModeEnabled() ? 'activeColorNight' : 'activeColor')
            }}"
            matTooltip="Reset color balance"
          >
            <img src="assets/images/reset.png" class="balanceButtonImg" />
          </button>
          } @if (!openRefImageEnabled() || !refImageSelected) {
          <button
            type="button"
            mat-button
            disabled
            class="buttonColorBalance buttonDisabledZoom"
            matTooltip="Reset color balance"
          >
            <img src="assets/images/reset.png" class="balanceButtonImg" />
          </button>
          }
        </div>

        <div class="normalizeCheckBox">
          <mat-checkbox
            [(ngModel)]="normalizeColorBalance"
            (change)="colorNormalizationChanged()"
            [color]="colorTheme()"
            [disabled]="shouldShowSpinner() || !refImageSelected"
            >Normalize</mat-checkbox
          >
        </div>
      </div>
      <div class="sliderRow">
        <div class="sliderLabel">Red</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="1"
            min="-100"
            max="100"
            (input)="redChanged($event, false)"
            (change)="redChanged($event, true)"
            [(ngModel)]="red"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="red"
            sliderInputMinValue="-100"
            sliderInputMaxValue="100"
            (sliderInputValueChanged)="redChanged($event, true)"
          />
        </div>
      </div>
      <div class="sliderRow">
        <div class="sliderLabel">Green</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="1"
            min="-100"
            max="100"
            (input)="greenChanged($event, false)"
            (change)="greenChanged($event, true)"
            [(ngModel)]="green"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="green"
            sliderInputMinValue="-100"
            sliderInputMaxValue="100"
            (sliderInputValueChanged)="greenChanged($event, true)"
          />
        </div>
      </div>
      <div class="sliderRow">
        <div class="sliderLabel">Blue</div>
        <div class="slider">
          <mat-slider
            [disabled]="shouldShowSpinner() || !refImageSelected"
            step="1"
            min="-100"
            max="100"
            (input)="blueChanged($event, false)"
            (change)="blueChanged($event, true)"
            [(ngModel)]="blue"
            [color]="colorTheme()"
          ></mat-slider>
          <app-sliderinput
            [sliderInputValue]="blue"
            sliderInputMinValue="-100"
            sliderInputMaxValue="100"
            (sliderInputValueChanged)="blueChanged($event, true)"
          />
        </div>
      </div>

      <!-- Dispersion corrector-->
      <div class="sliderRow">
        <div
          class="sliderRowCategoryTitle {{
            nightModeEnabled()
              ? 'sliderRowCategoryTitleColorNight'
              : 'sliderRowCategoryTitleColor'
          }}"
        >
          Dispersion
        </div>
        <div class="dispersionLeftButtons">
          <div class="dispersionPanelRow dispersionButton">
            @if (openRefImageEnabled() && refImageSelected) {
            <button
              type="button"
              mat-button
              (click)="dispersionCorrectionEnabledChanged()"
              class="{{
                'buttonZoom ' +
                  (nightModeEnabled() ? 'activeColorNight' : 'activeColor') +
                  (dispersionCorrectionEnabled ? 'Pressed' : '')
              }}"
              matTooltip="Dispersion Correction"
            >
              <img src="assets/images/dispersion.png" class="dispersionImg" />
            </button>
            } @if (!openRefImageEnabled() || !refImageSelected) {
            <button
              type="button"
              mat-button
              disabled
              class="buttonDisabledZoom"
              matTooltip="Dispersion Correction"
            >
              <img src="assets/images/dispersion.png" class="dispersionImg" />
            </button>
            }
          </div>
        </div>
        <div class="dispersionPanel">
          @if (dispersionCorrectionEnabled) {
          <section>
            <div class="dispersionPanelRow">
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="{{
                    dispersionCorrectionEnabled ? 'button' : 'button_disabled'
                  }} {{
                    nightModeEnabled() ? ' activeColorNight' : ' activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('LEFT-UP', 'RED')"
                >
                  <img
                    src="assets/images/left-up.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('UP', 'RED')"
                >
                  <img src="assets/images/up.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('RIGHT-UP', 'RED')"
                >
                  <img
                    src="assets/images/right-up.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
            </div>
            <div class="dispersionPanelRow">
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('LEFT', 'RED')"
                >
                  <img src="assets/images/left.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <div class="buttonAuto">Red</div>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('RIGHT', 'RED')"
                >
                  <img src="assets/images/right.png" class="dispersionArrow" />
                </button>
              </div>
            </div>
            <div class="dispersionPanelRow">
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('LEFT-DOWN', 'RED')"
                >
                  <img
                    src="assets/images/left-down.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('DOWN', 'RED')"
                >
                  <img src="assets/images/down.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('RIGHT-DOWN', 'RED')"
                >
                  <img
                    src="assets/images/right-down.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
            </div>
          </section>
          } @if (!dispersionCorrectionEnabled) {
          <section>
            <div class="dispersionPanelRow">
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img
                    src="assets/images/left-up.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img src="assets/images/up.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img
                    src="assets/images/right-up.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
            </div>
            <div class="dispersionPanelRow">
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img src="assets/images/left.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <div class="buttonAuto">Red</div>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img src="assets/images/right.png" class="dispersionArrow" />
                </button>
              </div>
            </div>
            <div class="dispersionPanelRow">
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img
                    src="assets/images/left-down.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img src="assets/images/down.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img
                    src="assets/images/right-down.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
            </div>
          </section>
          }
        </div>
        <div class="dispersionGutter"></div>
        <div class="dispersionPanel">
          @if (dispersionCorrectionEnabled) {
          <section>
            <div class="dispersionPanelRow">
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="{{
                    dispersionCorrectionEnabled ? 'button' : 'button_disabled'
                  }} {{
                    nightModeEnabled() ? ' activeColorNight' : ' activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('LEFT-UP', 'BLUE')"
                >
                  <img
                    src="assets/images/left-up.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('UP', 'BLUE')"
                >
                  <img src="assets/images/up.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('RIGHT-UP', 'BLUE')"
                >
                  <img
                    src="assets/images/right-up.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
              <div class="dispersionPanelColumn">&nbsp;</div>
            </div>
            <div class="dispersionPanelRow">
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('LEFT', 'BLUE')"
                >
                  <img src="assets/images/left.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <div class="buttonAuto">Blue</div>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('RIGHT', 'BLUE')"
                >
                  <img src="assets/images/right.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">&nbsp;</div>
            </div>
            <div class="dispersionPanelRow">
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('LEFT-DOWN', 'BLUE')"
                >
                  <img
                    src="assets/images/left-down.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('DOWN', 'BLUE')"
                >
                  <img src="assets/images/down.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  class="button {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="dispersionCorrectionClicked('RIGHT-DOWN', 'BLUE')"
                >
                  <img
                    src="assets/images/right-down.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                @if (dispersionCorrectionEnabled) {
                <button
                  type="button"
                  mat-button
                  class="buttonZoom resetButton {{
                    nightModeEnabled() ? 'activeColorNight' : 'activeColor'
                  }}"
                  (click)="resetDispersionCorrection()"
                  matTooltip="Reset"
                >
                  <img
                    src="assets/images/reset.png"
                    class="resetDispersionCorrection"
                  />
                </button>
                }
              </div>
            </div>
            <div class="dispersionIndicators">
              <div class="{{ dispersionIndicatorRedColor() }}">Red</div>
              dx: {{ profile.dispersionCorrectionRedX }}<br />
              dy: {{ profile.dispersionCorrectionRedY }}
            </div>
            <div class="dispersionIndicators dispersionIndicatorBlue">
              <div class="{{ dispersionIndicatorBlueColor() }}">Blue</div>
              dx: {{ profile.dispersionCorrectionBlueX }}<br />
              dy: {{ profile.dispersionCorrectionBlueY }}
            </div>
          </section>
          } @if (!dispersionCorrectionEnabled) {
          <section>
            <div class="dispersionPanelRow">
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img
                    src="assets/images/left-up.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img src="assets/images/up.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img
                    src="assets/images/right-up.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
              <div class="dispersionPanelColumn">&nbsp;</div>
            </div>
            <div class="dispersionPanelRow">
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img src="assets/images/left.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <div class="buttonAuto">Blue</div>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img src="assets/images/right.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">&nbsp;</div>
            </div>
            <div class="dispersionPanelRow">
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img
                    src="assets/images/left-down.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img src="assets/images/down.png" class="dispersionArrow" />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                <button
                  type="button"
                  mat-button
                  disabled
                  class="button_disabled"
                >
                  <img
                    src="assets/images/right-down.png"
                    class="dispersionArrow"
                  />
                </button>
              </div>
              <div class="dispersionPanelColumn">
                @if ( !dispersionCorrectionEnabled || !openRefImageEnabled() ||
                !refImageSelected ) {
                <button
                  type="button"
                  mat-button
                  disabled
                  class="buttonDisabledZoom resetButton"
                  matTooltip="Reset"
                >
                  <img
                    src="assets/images/reset.png"
                    class="resetDispersionCorrection"
                  />
                </button>
                }
              </div>
            </div>
          </section>
          }
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
